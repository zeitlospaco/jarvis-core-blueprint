# Environment Variables Reference

This document lists all environment variables used in the Jarvis Core Blueprint deployment.

## Required Variables (Must Set)

These variables **must** be configured before deployment:

| Variable | Description | Example | How to Generate |
|----------|-------------|---------|-----------------|
| `N8N_BASIC_AUTH_USER` | Username for n8n login | `admin` | Choose any username |
| `N8N_BASIC_AUTH_PASSWORD` | Password for n8n login | `SecureP@ss123!` | `openssl rand -base64 32` |
| `N8N_ENCRYPTION_KEY` | Encryption key for credentials | `abc123def456...` (64 chars) | `openssl rand -hex 32` |

## Database Variables (Auto-configured on Render)

### Option 1: Supabase Connection String (Recommended)

For using an external Supabase database, use a single connection string:

| Variable | Description | Example |
|----------|-------------|---------|
| `SUPABASE_DB_URL` | Full PostgreSQL connection string for Supabase | `postgres://postgres.xxxxx:password@db.supabase.co:5432/postgres` |

The connection string format is:
```
postgres://[user]:[password]@[host]:[port]/[database]
```

**How to get your Supabase connection string:**
1. Go to your Supabase project dashboard
2. Navigate to **Settings ‚Üí Database**
3. Find the **Connection String** section
4. Select **URI** format
5. Copy the connection string (includes password)

This variable is automatically used by n8n as `DB_POSTGRESDB_CONNECTION_STRING`.

### Option 2: Individual Database Parameters (Local PostgreSQL)

These are automatically set by Render when using the blueprint with the managed database:

| Variable | Description | Source |
|----------|-------------|--------|
| `DB_POSTGRESDB_HOST` | PostgreSQL host | From Render database or local `postgres` service |
| `DB_POSTGRESDB_PORT` | PostgreSQL port | From Render database or default `5432` |
| `DB_POSTGRESDB_DATABASE` | Database name | From Render database or default `n8n` |
| `DB_POSTGRESDB_USER` | Database user | From Render database or default `n8n_user` |
| `DB_POSTGRESDB_PASSWORD` | Database password | From Render database or `.env` |

**Note**: If `SUPABASE_DB_URL` is provided, it takes precedence over individual parameters.

## Optional But Recommended

Configure these for full functionality:

### Supabase Integration

| Variable | Description | Where to Find |
|----------|-------------|---------------|
| `SUPABASE_URL` | Supabase project URL | Project Settings ‚Üí API ‚Üí URL |
| `SUPABASE_ANON_KEY` | Anonymous/public key | Project Settings ‚Üí API ‚Üí anon public |
| `SUPABASE_SERVICE_KEY` | Service role key (secret!) | Project Settings ‚Üí API ‚Üí service_role (labeled as "service_role" in dashboard) |

**Note**: The environment variable is named `SUPABASE_SERVICE_KEY`, but in the Supabase dashboard it's shown as the "service_role" key. Use the actual key value from the dashboard.

### AI/LLM Services

| Variable | Description | Where to Get |
|----------|-------------|--------------|
| `OPENAI_API_KEY` | OpenAI API key | [platform.openai.com](https://platform.openai.com/api-keys) |
| `ANTHROPIC_API_KEY` | Claude/Anthropic key | [console.anthropic.com](https://console.anthropic.com/settings/keys) |
| `LANGCHAIN_API_KEY` | LangSmith tracking | [smith.langchain.com](https://smith.langchain.com/settings) |

### Vector Database

| Variable | Description | Where to Get |
|----------|-------------|--------------|
| `PINECONE_API_KEY` | Pinecone API key | [app.pinecone.io](https://app.pinecone.io/organizations) |
| `PINECONE_ENV` | Pinecone environment | From Pinecone dashboard (default: `us-east1-gcp`) |

### Email/SMTP (For Notifications)

| Variable | Description | Example |
|----------|-------------|---------|
| `SMTP_HOST` | SMTP server hostname | `smtp.gmail.com` |
| `SMTP_PORT` | SMTP port | `587` |
| `SMTP_USER` | SMTP username | `your-email@gmail.com` |
| `SMTP_PASSWORD` | SMTP password/app password | `yourapppassword` |
| `SMTP_FROM_EMAIL` | Sender email address | `noreply@yourdomain.com` |

## Pre-configured Variables

These are already set in `render.yaml` and don't need manual configuration:

| Variable | Value | Purpose |
|----------|-------|---------|
| `N8N_HOST` | `0.0.0.0` | Listen on all interfaces |
| `N8N_PORT` | `5678` | n8n web interface port |
| `N8N_PROTOCOL` | `https` | Use HTTPS protocol |
| `N8N_BASIC_AUTH_ACTIVE` | `true` | Enable basic authentication |
| `DB_TYPE` | `postgresdb` | Use PostgreSQL database |

## Auto-generated Variables

On Render, these are automatically generated:

| Variable | Generated By | Purpose |
|----------|--------------|---------|
| `WEBHOOK_URL` | Render | Your service's webhook URL |
| `N8N_EDITOR_BASE_URL` | Render | Your service's base URL |

## Quick Setup Guide

### 1. Generate Required Keys

```bash
# Generate strong password
openssl rand -base64 32

# Generate encryption key (copy full output)
openssl rand -hex 32
```

### 2. For Gmail SMTP

If using Gmail for email notifications:

1. Enable 2-factor authentication on your Google account
2. Go to: https://myaccount.google.com/apppasswords
3. Generate an app password
4. Use this as `SMTP_PASSWORD`

Settings:
```
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM_EMAIL=your-email@gmail.com
```

### 3. For SendGrid SMTP

If using SendGrid:

1. Sign up at https://sendgrid.com
2. Create API key in Settings ‚Üí API Keys
3. Use API key as password

Settings:
```
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USER=apikey
SMTP_PASSWORD=your-sendgrid-api-key
SMTP_FROM_EMAIL=verified-sender@yourdomain.com
```

## Environment Variable Priority

When deploying on Render:

1. **render.yaml** defines which variables are needed
2. **Render Dashboard** is where you set their values
3. **.env.example** is a reference template (not used in production)

## Updating Variables

### On Render

1. Go to your service in the dashboard
2. Click **Environment** tab
3. Edit or add variables
4. Click **Save Changes**
5. Service will automatically restart

### Locally (Development)

```bash
cp .env.example .env
# Edit .env with your values
nano .env
```

## Security Best Practices

- ‚úÖ **Never** commit `.env` files to git
- ‚úÖ Use strong, random passwords
- ‚úÖ Rotate keys every 90 days
- ‚úÖ Keep `SUPABASE_SERVICE_KEY` secret - never expose it
- ‚úÖ Use environment-specific keys (dev/staging/prod)
- ‚úÖ Enable 2FA on all service accounts

## Troubleshooting

### "Missing environment variable" error

1. Check the variable name matches exactly (case-sensitive)
2. Ensure no extra spaces in values
3. Verify the variable is set in Render dashboard
4. Try restarting the service

### "Database connection failed"

- Wait 2-3 minutes after deployment for database to be ready
- Check that database is "Available" in Render dashboard
- Verify `fromDatabase` references in render.yaml

### "Invalid encryption key"

- Key must be exactly 64 hexadecimal characters
- Regenerate with: `openssl rand -hex 32`
- Don't include extra whitespace or newlines

## Need Help?

- üìñ [Render Deployment Guide](RENDER_DEPLOYMENT.md)
- üìñ [Main README](README.md)
- üêõ [Report Issues](https://github.com/zeitlospaco/jarvis-core-blueprint/issues)
